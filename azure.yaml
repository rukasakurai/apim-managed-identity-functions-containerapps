# azure.yaml schema: https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json

name: apim-backend-services
metadata:
  template: apim-backend-services@0.0.1-beta

# Deployment configuration
infra:
  provider: bicep
  path: infra

# Services configuration
services:
  function:
    project: ./services/hello-function
    language: python
    host: function

hooks:
  postprovision:
    shell: sh
    run: |
      if [ "$DEPLOY_FUNCTIONS" = "true" ]; then
        ./scripts/shared/assign-backend-roles.sh function
      fi
  
  predown:
    shell: sh
    run: |
      echo "Cleaning up Entra ID app roles and assignments..."
      ./scripts/shared/cleanup-app-roles.sh
