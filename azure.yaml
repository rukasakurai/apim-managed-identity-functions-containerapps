# azure.yaml schema: https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json

name: apim-functions-app
metadata:
  template: apim-functions-app@0.0.1-beta

# Deployment configuration
infra:
  provider: bicep
  path: infra

# Services configuration
services:
  function:
    project: ./hello-function
    language: python
    host: function

hooks:
  postprovision:
    shell: sh
    run: |
      ./scripts/assign-apim-mi-to-functionapp-app-role.sh
#      ./scripts/set-easyauth-allowed-client-applications.sh
  
  predown:
    shell: sh
    run: |
      echo "Cleaning up Entra ID app roles and assignments..."
      ./scripts/cleanup-app-roles.sh
